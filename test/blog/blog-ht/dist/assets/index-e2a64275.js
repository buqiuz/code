import{_ as W}from"./index-b16fe835.js";import Z from"./detail-modal-4c61b674.js";import{n as S,q as Y,s as ee}from"./index-207c8571.js";import{m as d,ak as te,al as ae,X as ne,Y as se,S as oe,y as le,am as ie,J as ce,A as re,z as de,a0 as ue,ao as pe}from"./antd-62e1c33f.js";import{d as me,a as R,r as y,o as _e,j as fe,a0 as v,a1 as f,a2 as k,a3 as n,c as t,u as o,E as b,af as x,ae as ge,a5 as ye,F as ve,aj as ke,a8 as C}from"./vue-54d91d02.js";import"./index.vue_vue_type_script_setup_true_lang-c5238c8c.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-fa2f7517.js";async function be(){return S("/user/list").catch(r=>d.warn(r))}async function we(r){return Y("/user/search",r).catch(l=>d.warn(l))}async function he(r,l){return Y("/user/update/status",{id:r,status:l})}async function De(r){return S(`/user/details/${r}`).catch(l=>d.warn(l))}async function xe(r){return ee("/user/delete",{ids:r}).catch(l=>d.warn(l))}const Ce=C("span",null,"详细",-1),Ie=C("span",{style:{"margin-inline-start":"1px"}},"详情",-1),Te=C("span",{style:{"margin-inline-start":"1px"}},"删除",-1),Oe=C("span",{style:{"margin-inline-start":"1px"}},"分配角色",-1),Fe=me({__name:"index",setup(r){const l=R({username:void 0,email:void 0,isDisable:void 0,time:void 0}),B=[{title:"用户编号",dataIndex:"id",align:"center"},{title:"用户头像",dataIndex:"avatar",align:"center"},{title:"用户名称",dataIndex:"username",align:"center"},{title:"用户邮箱",dataIndex:"email",align:"center"},{title:"状态",dataIndex:"isDisable",align:"center",key:"status"},{title:"注册方式",dataIndex:"registerType",align:"center"},{title:"登录地址",dataIndex:"loginAddress",align:"center"},{title:"创建时间",dataIndex:"createTime",align:"center"},{title:"操作",dataIndex:"operation",key:"operation",align:"center"}],w=y(!1),h=y([]);_e(()=>{D()});async function D(a){w.value=!0;let e;if(a)e=a;else{const{data:i}=await be();e=i}e&&e.length>0&&(e=e.map(i=>{switch(i.isDisable=i.isDisable===0,i.registerType){case 0:i.registerType="邮箱/用户名";break;case 1:i.registerType="Gitee";break;case 2:i.registerType="Github";break;default:i.registerType="未知";break}return i})),h.value=e,w.value=!1}async function F(a){const e={...a};a.time&&a.time[0]&&Object.assign(e,{createTimeStart:a.time[0].format("YYYY-MM-DD HH:mm:ss")}),a.time&&a.time[1]&&Object.assign(e,{createTimeEnd:a.time[1].format("YYYY-MM-DD HH:mm:ss")}),w.value=!0;const{data:i}=await we(e);await D(i)}async function V(a,e){(await he(a,e?0:1).catch(m=>{d.warn(m),h.value=h.value.map(p=>(a===p.id&&setTimeout(()=>{p.isDisable=!p.isDisable},500),p))})).code===200&&(e?d.success("已启用"):d.info("已停用"))}const u=R({selectedRowKeys:[],loading:!1}),j=fe(()=>u.selectedRowKeys.length>0&&u.selectedRowKeys.length===1);function A(a){u.selectedRowKeys=a}function O(a){te.confirm({title:"注意",icon:t(ae),content:`确定删除编号为 【${a.join(",")}】 的角色吗？`,okText:"确认",cancelText:"取消",onOk:()=>{xe(a).then(e=>{e.code===200&&(d.success("删除成功"),u.selectedRowKeys=[],D())})}})}const I=y(!1),T=y(),K=y(!1);async function M(a){a||(a=u.selectedRowKeys[0]),I.value=!0;const{data:e}=await De(a);T.value=e}function N(){I.value=!1,T.value=void 0}return(a,e)=>{const i=ne,m=se,p=oe,E=le,H=ie,U=v("SolutionOutlined"),_=ce,$=v("DeleteOutlined"),q=v("VerticalAlignBottomOutlined"),z=v("InsertModal"),G=re,P=de,J=ue,L=v("KeyOutlined"),X=pe,Q=W;return f(),k(Q,{"form-state":o(l),"onUpdate:refreshFunc":D,"onUpdate:onFinish":F},{"form-items":n(()=>[t(m,{label:"用户名称",name:"username"},{default:n(()=>[t(i,{value:o(l).username,"onUpdate:value":e[0]||(e[0]=s=>o(l).username=s),placeholder:"请输人用户名称",style:{width:"250px"}},null,8,["value"])]),_:1}),t(m,{label:"用户邮箱",name:"email"},{default:n(()=>[t(i,{value:o(l).email,"onUpdate:value":e[1]||(e[1]=s=>o(l).email=s),placeholder:"请输入用户邮箱",style:{width:"250px"}},null,8,["value"])]),_:1}),t(m,{label:"状态",name:"isDisable",style:{width:"240px"}},{default:n(()=>[t(E,{value:o(l).isDisable,"onUpdate:value":e[2]||(e[2]=s=>o(l).isDisable=s),placeholder:"用户状态"},{default:n(()=>[t(p,{value:0},{default:n(()=>[b(" 正常 ")]),_:1}),t(p,{value:1},{default:n(()=>[b(" 停用 ")]),_:1})]),_:1},8,["value"])]),_:1}),t(m,{label:"创建时间",name:"time"},{default:n(()=>[t(H,{value:o(l).time,"onUpdate:value":e[3]||(e[3]=s=>o(l).time=s),placeholder:["开始时间","结束时间"]},null,8,["value"])]),_:1})]),"operate-btn":n(()=>[t(_,{class:"light-blue",disabled:!o(j),onClick:e[4]||(e[4]=s=>M())},{icon:n(()=>[t(U)]),default:n(()=>[Ce]),_:1},8,["disabled"]),t(_,{type:"dashed",danger:"",ghost:"",disabled:!(o(u).selectedRowKeys.length>0),onClick:e[5]||(e[5]=s=>O(o(u).selectedRowKeys))},{icon:n(()=>[t($)]),default:n(()=>[b(" 删除 ")]),_:1},8,["disabled"]),t(_,{class:"orange",onClick:e[6]||(e[6]=s=>o(d).warn("别点了，有空再写"))},{icon:n(()=>[t(q)]),default:n(()=>[b(" 导出 ")]),_:1})]),"table-content":n(()=>[t(Z,{"modal-open":o(I),data:o(T),"onUpdate:close:modal":N},null,8,["modal-open","data"]),t(z,{"modal-open":o(K),"onUpdate:close:modal":e[7]||(e[7]=s=>K.value=!1)},null,8,["modal-open"]),t(X,{columns:B,"data-source":o(h),loading:o(w),"row-selection":{selectedRowKeys:o(u).selectedRowKeys,onChange:A},"row-key":s=>s.id,size:"small"},{bodyCell:n(({column:s,record:c})=>[s.dataIndex==="avatar"?(f(),k(G,{key:0,shape:"square",size:"large",src:c.avatar,alt:"无法显示头像"},null,8,["src"])):x("",!0),s.dataIndex==="isDisable"?(f(),k(P,{key:1,checked:c.isDisable,"onUpdate:checked":g=>c.isDisable=g,onChange:g=>V(c.id,c.isDisable)},null,8,["checked","onUpdate:checked","onChange"])):x("",!0),s.dataIndex==="registerType"?(f(),k(J,{key:2,color:"blue"},{default:n(()=>[b(ge(c.registerType),1)]),_:2},1024)):x("",!0),s.key==="operation"?(f(),ye(ve,{key:3},[t(_,{type:"link",style:{padding:"0"},onClick:g=>M(c.id)},{icon:n(()=>[t(U)]),default:n(()=>[Ie]),_:2},1032,["onClick"]),t(_,{type:"link",style:{padding:"0","margin-left":"5px"},onClick:g=>O([c.id])},{icon:n(()=>[t($)]),default:n(()=>[Te]),_:2},1032,["onClick"]),t(_,{type:"link",style:{padding:"0","margin-left":"5px"},onClick:g=>a.$router.push({path:"/user/role",query:{id:c.id,name:c.roleName}})},{icon:n(()=>[t(L)]),default:n(()=>[Oe]),_:2},1032,["onClick"])],64)):s.key==="icon"?(f(),k(ke(c.icon),{key:4})):x("",!0)]),_:1},8,["data-source","loading","row-selection","row-key"])]),_:1},8,["form-state"])}}});export{Fe as default};
