import{_ as te}from"./index-b16fe835.js";import{N as ne}from"./index-6b188c69.js";import{m,ap as I,d as Y,ak as G,al as ae,X as oe,Y as se,S as ie,y as le,am as ce,J as de,A as ue,a1 as pe,B as re,E as me,z as _e,an as fe,x as he,ao as ge}from"./antd-62e1c33f.js";import{n as ke,q as V,s as ve}from"./index-207c8571.js";import{d as ye,a as N,o as Ce,r as R,a0 as we,a1 as h,a2 as b,a3 as t,c as n,u as s,E as r,a8 as k,ae as g,af as C,a5 as K,F as M}from"./vue-54d91d02.js";import"./index.vue_vue_type_script_setup_true_lang-c5238c8c.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-fa2f7517.js";async function xe(){return ke("/chatGpt/back/list").catch(p=>m.warn(p))}async function be(p){return V("/chatGpt/back/search",p).catch(l=>m.warn(l))}async function Ie(p){return V("/chatGpt/back/isCheck",p).catch(l=>m.warn(l))}async function O(p){return ve("/chatGpt/back/delete",JSON.stringify(p)).catch(l=>m.warn(l))}const Ne={style:{color:"#1677FF"}},De={style:{"margin-left":"0.2rem"}},Te=k("span",{style:{"margin-left":"3px"}},"查看",-1),$e=k("span",{style:{"margin-left":"3px"}},"删除",-1),Ve=ye({__name:"index",setup(p){const l=N({userName:void 0,isCheck:void 0,type:void 0,time:void 0}),B="http://8.137.91.234:9000";Ce(async()=>{await w()});const _=N({selectedRowKeys:[],loading:!1}),v=R(!1),f=R([]);function S(a){_.selectedRowKeys=a}const E=[{title:"编号",dataIndex:"id",align:"center"},{title:"用户名称",dataIndex:"userName",align:"center"},{title:"会话记录",dataIndex:"conversation",align:"center"},{title:"是否有效",dataIndex:"isCheck",align:"center"},{title:"创建时间",dataIndex:"createTime",align:"center"},{title:"修改时间",dataIndex:"createTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}],u=N({show:!1,conversation:{content:[],model:""},avatar:""});async function w(){v.value=!0;const{data:a}=await xe();a&&a.length>0&&(f.value=a.map(e=>(e.isCheck=e.isCheck===1,e))),v.value=!1}async function H(a){v.value=!0;const e={...a,startTime:a.time&&a.time.length>0?Y(a.time[0]).format("YYYY-MM-DD HH:mm:ss"):void 0,endTime:a.time&&a.time.length>0?Y(a.time[1]).format("YYYY-MM-DD HH:mm:ss"):void 0},{data:c}=await be(e);c&&c.length>0?f.value=c.map(d=>(d.isCheck=d.isCheck===1,d)):(m.warn("没有查询到相关收藏内容"),f.value=[]),v.value=!1}function q(a,e,c){c.isCheckloading=!0,e=e?1:0,Ie({id:a,isCheck:e}).then(d=>{d.code===200&&(m.success("操作成功"),c.isCheckloading=!1)})}function D(a){if(a)O(a).then(e=>{e.code===200&&(m.success("删除成功"),w())});else{const e=_.selectedRowKeys;G.confirm({title:"注意",icon:n(ae),content:`确定删除编号为 【${e.join(",")}】 的收藏吗？`,okText:"确认",cancelText:"取消",onOk:()=>{O(e).then(c=>{c.code===200&&(m.success("删除成功"),w())})}})}}function T(a){var e,c;a||(a=_.selectedRowKeys[0]),u.show=!0,u.conversation=JSON.parse((e=f.value.find(d=>d.id===a))==null?void 0:e.conversation),u.avatar=(c=f.value.find(d=>d.id===a))==null?void 0:c.avatar,console.log(u.conversation)}return(a,e)=>{const c=oe,d=se,$=ie,z=le,J=ce,y=de,F=we("DeleteOutlined"),j=ue,A=pe,P=re,L=me,X=G,Q=_e,W=fe,U=he,Z=ge,ee=te;return h(),b(ee,{"form-state":s(l),"onUpdate:refreshFunc":w,"onUpdate:onFinish":H},{"form-items":t(()=>[n(d,{label:"用户名称",name:"userName",style:{"margin-right":"1rem"}},{default:t(()=>[n(c,{value:s(l).userName,"onUpdate:value":e[0]||(e[0]=o=>s(l).userName=o),placeholder:"输入用户名称",style:{width:"15em"}},null,8,["value"])]),_:1}),n(d,{label:"是否通过",name:"isCheck",style:{"margin-right":"1rem"}},{default:t(()=>[n(z,{value:s(l).isCheck,"onUpdate:value":e[1]||(e[1]=o=>s(l).isCheck=o),style:{width:"13em"},placeholder:"是否通过"},{default:t(()=>[n($,{value:1},{default:t(()=>[r(" 是 ")]),_:1}),n($,{value:0},{default:t(()=>[r(" 否 ")]),_:1})]),_:1},8,["value"])]),_:1}),n(d,{label:"创建时间",name:"time"},{default:t(()=>[n(J,{value:s(l).time,"onUpdate:value":e[2]||(e[2]=o=>s(l).time=o),placeholder:["开始时间","结束时间"]},null,8,["value"])]),_:1})]),"operate-btn":t(()=>[n(y,{type:"default",style:{"margin-right":"10px"},disabled:s(_).selectedRowKeys.length!==1,onClick:e[3]||(e[3]=o=>T())},{icon:t(()=>[n(s(I))]),default:t(()=>[r(" 查看 ")]),_:1},8,["disabled"]),n(y,{type:"dashed",danger:"",ghost:"",disabled:s(_).selectedRowKeys.length===0,onClick:e[4]||(e[4]=o=>D())},{icon:t(()=>[n(F)]),default:t(()=>[r(" 删除 ")]),_:1},8,["disabled"]),n(X,{open:s(u).show,"onUpdate:open":e[6]||(e[6]=o=>s(u).show=o),width:"800px"},{title:t(()=>[k("span",Ne,[n(s(I))]),k("span",De,"查看会话-"+g(s(u).conversation.model),1)]),footer:t(()=>[n(y,{onClick:e[5]||(e[5]=o=>s(u).show=!1)},{default:t(()=>[r(" 关闭 ")]),_:1})]),default:t(()=>[n(L,{"item-layout":"horizontal","data-source":s(u).conversation.content},{renderItem:t(({item:o})=>[n(P,null,{default:t(()=>[n(A,{description:o.type==="question"?"提问":"应答"},{title:t(()=>[n(s(ne),{modelValue:o.content,"onUpdate:modelValue":i=>o.content=i},null,8,["modelValue","onUpdate:modelValue"])]),avatar:t(()=>[n(j,{src:o.type==="question"?s(u).avatar:`${s(B)}blog/gpt/chatgpt-de79290a.png`},null,8,["src"])]),_:2},1032,["description"])]),_:2},1024)]),_:1},8,["data-source"])]),_:1},8,["open"])]),"table-content":t(()=>[n(Z,{columns:E,"data-source":s(f),loading:s(v),"row-selection":{selectedRowKeys:s(_).selectedRowKeys,onChange:S},"row-key":o=>o.id,size:"small"},{bodyCell:t(({column:o,record:i})=>[o.dataIndex==="isCheck"?(h(),b(Q,{key:0,checked:i.isCheck,"onUpdate:checked":x=>i.isCheck=x,"checked-children":"是","un-checked-children":"否",loading:i.isCheckloading,onChange:x=>q(i.id,i.isCheck,i)},null,8,["checked","onUpdate:checked","loading","onChange"])):C("",!0),o.dataIndex==="conversation"?(h(),K(M,{key:1},[r(g(i.conversation.length>40?`${i.conversation.slice(0,40)}...`:i.conversation),1)],64)):C("",!0),o.dataIndex==="operation"?(h(),K(M,{key:2},[n(y,{type:"link",style:{padding:"0"},onClick:x=>T(i.id)},{icon:t(()=>[n(s(I))]),default:t(()=>[Te]),_:2},1032,["onClick"]),n(W,{title:"是否确定删除","ok-text":"Yes","cancel-text":"No",onConfirm:x=>D([i.id])},{default:t(()=>[n(y,{type:"link",style:{padding:"0"}},{icon:t(()=>[n(F)]),default:t(()=>[$e]),_:1})]),_:2},1032,["onConfirm"])],64)):C("",!0),o.dataIndex==="createTime"?(h(),b(U,{key:3,placement:"top"},{title:t(()=>[k("span",null,g(i.createTime),1)]),default:t(()=>[r(" "+g(i.createTime.split(" ")[0])+"... ",1)]),_:2},1024)):C("",!0),o.dataIndex==="updateTime"?(h(),b(U,{key:4,placement:"top"},{title:t(()=>[k("span",null,g(i.updateTime),1)]),default:t(()=>[r(" "+g(i.updateTime.split(" ")[0])+"... ",1)]),_:2},1024)):C("",!0)]),_:1},8,["data-source","loading","row-selection","row-key"])]),_:1},8,["form-state"])}}});export{Ve as default};
