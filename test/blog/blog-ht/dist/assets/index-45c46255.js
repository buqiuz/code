import{_ as A}from"./index-b16fe835.js";import{N as Q}from"./index-6b188c69.js";import{m as r,ap as T,d as R,ak as U,al as W,X as Z,Y as ee,S as te,y as ne,am as ae,J as oe,z as se,an as le,x as ie,ao as ce}from"./antd-62e1c33f.js";import{n as de,q as V,s as ue}from"./index-207c8571.js";import{d as me,a as I,o as re,r as $,a0 as pe,a1 as f,a2 as b,a3 as t,c as a,u as o,E as m,a8 as h,af as C,a5 as K,F as M,ae as w}from"./vue-54d91d02.js";import"./index.vue_vue_type_script_setup_true_lang-c5238c8c.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-fa2f7517.js";async function _e(){return de("/treeHole/back/list").catch(u=>r.warn(u))}async function fe(u){return V("/treeHole/back/search",u).catch(i=>r.warn(i))}async function he(u){return V("/treeHole/back/isCheck",u).catch(i=>r.warn(i))}async function O(u){return ue("/treeHole/back/delete",JSON.stringify(u)).catch(i=>r.warn(i))}const ge={style:{color:"#1677FF"}},ke=h("span",{style:{"margin-left":"0.2rem"}},"查看内容",-1),ye=h("span",{style:{"margin-left":"3px"}},"查看",-1),Ce=h("span",{style:{"margin-left":"3px"}},"删除",-1),Ne=me({__name:"index",setup(u){const i=I({userName:void 0,isCheck:void 0,time:void 0});re(async()=>{await v()});const _=I({selectedRowKeys:[],loading:!1}),g=$(!1),k=$([]);function B(n){_.selectedRowKeys=n}const S=[{title:"编号",dataIndex:"id",align:"center"},{title:"用户名称",dataIndex:"userName",align:"center"},{title:"树洞内容",dataIndex:"content",align:"center"},{title:"是否通过",dataIndex:"isCheck",align:"center"},{title:"发送时间",dataIndex:"createTime",align:"center"},{title:"更新时间",dataIndex:"updateTime",align:"center"},{title:"操作",dataIndex:"operation",align:"center"}];async function v(){g.value=!0;const{data:n}=await _e();n&&n.length>0&&(k.value=n.map(e=>(e.isCheck=e.isCheck===1,e))),g.value=!1}async function E(n){g.value=!0;const e={...n,startTime:n.time&&n.time.length>0?R(n.time[0]).format("YYYY-MM-DD HH:mm:ss"):void 0,endTime:n.time&&n.time.length>0?R(n.time[1]).format("YYYY-MM-DD HH:mm:ss"):void 0},{data:c}=await fe(e);c&&c.length>0?k.value=c.map(d=>(d.isCheck=d.isCheck===1,d)):(r.warn("没有查询到相关树洞内容"),k.value=[]),g.value=!1}function j(n,e,c){c.isCheckloading=!0,e=e?1:0,he({id:n,isCheck:e}).then(d=>{d.code===200&&(r.success("操作成功"),c.isCheckloading=!1)})}function D(n){if(n)O(n).then(e=>{e.code===200&&(r.success("删除成功"),v())});else{const e=_.selectedRowKeys;U.confirm({title:"注意",icon:a(W),content:`确定删除编号为 【${e.join(",")}】 的树洞吗？`,okText:"确认",cancelText:"取消",onOk:()=>{O(e).then(c=>{c.code===200&&(r.success("删除成功"),v())})}})}}const p=I({show:!1,content:""});function H(n){var e;n||(n=_.selectedRowKeys[0]),p.show=!0,p.content=(e=k.value.find(c=>c.id===n))==null?void 0:e.content}return(n,e)=>{const c=Z,d=ee,N=te,z=ne,J=ae,y=oe,F=pe("DeleteOutlined"),P=U,q=se,G=le,Y=ie,L=ce,X=A;return f(),b(X,{"form-state":o(i),"onUpdate:refreshFunc":v,"onUpdate:onFinish":E},{"form-items":t(()=>[a(d,{label:"用户名称",name:"userName",style:{"margin-right":"1rem"}},{default:t(()=>[a(c,{value:o(i).userName,"onUpdate:value":e[0]||(e[0]=s=>o(i).userName=s),placeholder:"输入用户名称",style:{width:"15em"}},null,8,["value"])]),_:1}),a(d,{label:"是否通过",name:"isCheck",style:{"margin-right":"1rem"}},{default:t(()=>[a(z,{value:o(i).isCheck,"onUpdate:value":e[1]||(e[1]=s=>o(i).isCheck=s),style:{width:"13em"},placeholder:"是否通过"},{default:t(()=>[a(N,{value:1},{default:t(()=>[m(" 是 ")]),_:1}),a(N,{value:0},{default:t(()=>[m(" 否 ")]),_:1})]),_:1},8,["value"])]),_:1}),a(d,{label:"创建时间",name:"time"},{default:t(()=>[a(J,{value:o(i).time,"onUpdate:value":e[2]||(e[2]=s=>o(i).time=s),placeholder:["开始时间","结束时间"]},null,8,["value"])]),_:1})]),"operate-btn":t(()=>[a(y,{type:"default",style:{"margin-right":"10px"},disabled:o(_).selectedRowKeys.length!==1,onClick:e[3]||(e[3]=s=>H())},{icon:t(()=>[a(o(T))]),default:t(()=>[m(" 查看 ")]),_:1},8,["disabled"]),a(y,{type:"dashed",danger:"",ghost:"",disabled:o(_).selectedRowKeys.length===0,onClick:e[4]||(e[4]=s=>D())},{icon:t(()=>[a(F)]),default:t(()=>[m(" 删除 ")]),_:1},8,["disabled"]),a(P,{open:o(p).show,"onUpdate:open":e[7]||(e[7]=s=>o(p).show=s),width:"700px"},{title:t(()=>[h("span",ge,[a(o(T))]),ke]),footer:t(()=>[a(y,{onClick:e[5]||(e[5]=s=>o(p).show=!1)},{default:t(()=>[m(" 关闭 ")]),_:1})]),default:t(()=>[a(o(Q),{modelValue:o(p).content,"onUpdate:modelValue":e[6]||(e[6]=s=>o(p).content=s)},null,8,["modelValue"])]),_:1},8,["open"])]),"table-content":t(()=>[a(L,{columns:S,"data-source":o(k),loading:o(g),"row-selection":{selectedRowKeys:o(_).selectedRowKeys,onChange:B},"row-key":s=>s.id,size:"small"},{bodyCell:t(({column:s,record:l})=>[s.dataIndex==="isCheck"?(f(),b(q,{key:0,checked:l.isCheck,"onUpdate:checked":x=>l.isCheck=x,"checked-children":"是","un-checked-children":"否",loading:l.isCheckloading,onChange:x=>j(l.id,l.isCheck,l)},null,8,["checked","onUpdate:checked","loading","onChange"])):C("",!0),s.dataIndex==="content"?(f(),K(M,{key:1},[m(w(l.content.length>7?`${l.content.slice(0,7)}...`:l.content),1)],64)):C("",!0),s.dataIndex==="operation"?(f(),K(M,{key:2},[a(y,{type:"link",style:{padding:"0"},onClick:x=>H(l.id)},{icon:t(()=>[a(o(T))]),default:t(()=>[ye]),_:2},1032,["onClick"]),a(G,{title:"是否确定删除","ok-text":"Yes","cancel-text":"No",onConfirm:x=>D([l.id])},{default:t(()=>[a(y,{type:"link",style:{padding:"0"}},{icon:t(()=>[a(F)]),default:t(()=>[Ce]),_:1})]),_:2},1032,["onConfirm"])],64)):C("",!0),s.dataIndex==="createTime"?(f(),b(Y,{key:3,placement:"top"},{title:t(()=>[h("span",null,w(l.createTime),1)]),default:t(()=>[m(" "+w(l.createTime.split(" ")[0])+"... ",1)]),_:2},1024)):C("",!0),s.dataIndex==="updateTime"?(f(),b(Y,{key:4,placement:"top"},{title:t(()=>[h("span",null,w(l.updateTime),1)]),default:t(()=>[m(" "+w(l.updateTime.split(" ")[0])+"... ",1)]),_:2},1024)):C("",!0)]),_:1},8,["data-source","loading","row-selection","row-key"])]),_:1},8,["form-state"])}}});export{Ne as default};
