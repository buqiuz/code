import{_ as ee}from"./index-b16fe835.js";import{n as ne,q as E,s as te,_ as ae}from"./index-207c8571.js";import{m as h,X as oe,Y as le,S as se,y as ie,J as ce,an as de,z as ue,a0 as pe,aq as me,x as _e,ao as re}from"./antd-62e1c33f.js";import{d as fe,h as he,r as C,a as ye,o as ge,a0 as I,a1 as f,a2 as y,a3 as e,c as t,u as c,E as u,a8 as v,a5 as ke,F as ve,af as g,ae as k,a6 as xe,a7 as Ce}from"./vue-54d91d02.js";import"./index.vue_vue_type_script_setup_true_lang-c5238c8c.js";import"./chunk-YXBPAIHU-f2871816.js";import"./context-fa2f7517.js";async function we(){return ne("/comment/back/list").catch(d=>h.warn(d))}async function Ie(d){return E("/comment/back/search",d).catch(_=>h.warn(_))}async function be(d){return E("/comment/back/isCheck",d).catch(_=>h.warn(_))}async function Ue(d){return te(`/comment/back/delete/${d}`).catch(_=>h.warn(_))}const K=d=>(xe("data-v-8a66d334"),d=d(),Ce(),d),Fe=["href"],Ne=K(()=>v("span",{style:{"margin-inline-start":"1px"}},"跳转",-1)),Oe=K(()=>v("span",{style:{"margin-left":"3px"}},"删除",-1)),$e=fe({__name:"index",setup(d,{expose:_}){_({h:he});const x=C(!0),p=ye({commentUserName:"",commentContent:"",type:void 0,isCheck:void 0}),N=C(),b=C([]);async function R(a){x.value=!0;const{data:n}=await Ie(a);x.value=!1,b.value=$(n)}function S(a){console.log("出现错误:",a)}const L=C([{title:"编号",dataIndex:"id",align:"center"},{title:"评论类型",dataIndex:"type",align:"center"},{title:"类型编号",dataIndex:"typeId",align:"center"},{title:"评论内容",dataIndex:"commentContent",align:"center"},{title:"评论用户",dataIndex:"commentUserName",align:"center"},{title:"是否通过",dataIndex:"isCheck",align:"center"},{title:"评论时间",dataIndex:"createTime",align:"center"},{title:"操作",key:"operation",align:"center"}]);ge(()=>{O()});async function O(){const{data:a}=await we();N.value=a,b.value=$(a),x.value=!1}function $(a){const n=a.filter(o=>o.parentId===null);return n.forEach(o=>{o.key=o.id,o.isCheck=o.isCheck===1;const l=A(o,a);l.length>0&&(o.children=l)}),n}function A(a,n){const o=n.filter(l=>l.parentId===a.id);return o.forEach(l=>{l.key=l.id,l.isCheck=l.isCheck===1;const r=A(l,n);r.length>0&&(l.children=r)}),o}const m=C({expandedRowKeys:[],flag:!1});function T(){m.value.flag?(m.value.expandedRowKeys=[],m.value.flag=!1):(m.value.expandedRowKeys=N.value.map(a=>a.id),m.value.flag=!0)}function V(a,n){if(a)m.value.expandedRowKeys.push(n.key);else{const o=m.value.expandedRowKeys.indexOf(n.key);o>-1&&m.value.expandedRowKeys.splice(o,1)}}function U(){x.value=!0,O()}function q(a,n,o){o.isCheckloading=!0,n=n?1:0,be({id:a,isCheck:n}).then(l=>{l.code===200&&(h.success("操作成功，相关子评论将变成同一状态"),o.isCheckloading=!1,U())})}async function z(a){Ue(a).then(n=>{n.code===200&&(h.success("删除成功"),U())})}const M="http://kuailemao.xyz/";return(a,n)=>{const o=oe,l=le,r=se,B=ie,Y=I("VerticalAlignBottomOutlined"),w=ce,G=I("ArrowsAltOutlined"),J=I("LinkOutlined"),P=I("DeleteOutlined"),X=de,j=ue,D=pe,H=me,Q=_e,W=re,Z=ee;return f(),y(Z,{"form-state":c(p),"onUpdate:refreshFunc":U,"onUpdate:onFinish":R,"onUpdate:onFinishFailed":S},{"form-items":e(()=>[t(l,{label:"评论用户",name:"commentUserName"},{default:e(()=>[t(o,{value:c(p).commentUserName,"onUpdate:value":n[0]||(n[0]=i=>c(p).commentUserName=i),placeholder:"请输入评论用户"},null,8,["value"])]),_:1}),t(l,{label:"评论内容",name:"commentContent"},{default:e(()=>[t(o,{value:c(p).commentContent,"onUpdate:value":n[1]||(n[1]=i=>c(p).commentContent=i),placeholder:"请输入评论内容"},null,8,["value"])]),_:1}),t(l,{label:"评论类型",name:"type",style:{width:"240px"}},{default:e(()=>[t(B,{value:c(p).type,"onUpdate:value":n[2]||(n[2]=i=>c(p).type=i),placeholder:"评论类型"},{default:e(()=>[t(r,{value:1},{default:e(()=>[u(" 文章 ")]),_:1}),t(r,{value:2},{default:e(()=>[u(" 留言 ")]),_:1})]),_:1},8,["value"])]),_:1}),t(l,{label:"是否通过",name:"isCheck",style:{width:"240px"}},{default:e(()=>[t(B,{value:c(p).isCheck,"onUpdate:value":n[3]||(n[3]=i=>c(p).isCheck=i),placeholder:"是否通过"},{default:e(()=>[t(r,{value:1},{default:e(()=>[u(" 是 ")]),_:1}),t(r,{value:0},{default:e(()=>[u(" 否 ")]),_:1})]),_:1},8,["value"])]),_:1})]),"operate-btn":e(()=>[v("div",null,[t(w,{class:"orange",onClick:n[4]||(n[4]=i=>c(h).warn("别点了，有空再写"))},{icon:e(()=>[t(Y)]),default:e(()=>[u(" 导出 ")]),_:1}),t(w,{type:"dashed",style:{"margin-bottom":"10px",color:"grey"},onClick:T},{icon:e(()=>[t(G)]),default:e(()=>[u(" 展开/折叠 ")]),_:1})])]),"table-content":e(()=>[v("div",null,[t(W,{columns:c(L),"data-source":c(b),"expanded-row-keys":c(m).expandedRowKeys,loading:c(x),onExpand:V},{bodyCell:e(({column:i,record:s})=>[i.key==="operation"?(f(),ke(ve,{key:0},[v("a",{href:`${c(M)}article/${s.id}`,target:"_blank"},[t(w,{type:"link",style:{padding:"0"}},{icon:e(()=>[t(J)]),default:e(()=>[Ne]),_:1})],8,Fe),t(X,{title:"是否确定删除","ok-text":"Yes","cancel-text":"No",onConfirm:F=>z(s.id)},{default:e(()=>[t(w,{type:"link",style:{padding:"0"}},{icon:e(()=>[t(P)]),default:e(()=>[Oe]),_:1})]),_:2},1032,["onConfirm"])],64)):g("",!0),i.dataIndex==="isCheck"?(f(),y(j,{key:1,checked:s.isCheck,"onUpdate:checked":F=>s.isCheck=F,"checked-children":"是","un-checked-children":"否",loading:s.isCheckloading,onChange:F=>q(s.id,s.isCheck,s)},null,8,["checked","onUpdate:checked","loading","onChange"])):g("",!0),i.dataIndex==="type"?(f(),y(D,{key:2,color:"blue"},{default:e(()=>[u(k(s.type===1?"文章":"留言"),1)]),_:2},1024)):g("",!0),i.dataIndex==="typeId"?(f(),y(D,{key:3},{default:e(()=>[u(k(s.typeId),1)]),_:2},1024)):g("",!0),i.dataIndex==="commentContent"?(f(),y(H,{key:4,title:"评论"},{content:e(()=>[u(k(s.commentContent),1)]),default:e(()=>[u(" "+k(s.commentContent.length>10?`${s.commentContent.substring(0,10)}...`:s.commentContent),1)]),_:2},1024)):g("",!0),i.dataIndex==="createTime"?(f(),y(Q,{key:5,placement:"top"},{title:e(()=>[v("span",null,k(s.createTime),1)]),default:e(()=>[u(" "+k(s.createTime.split(" ")[0])+"... ",1)]),_:2},1024)):g("",!0)]),_:1},8,["columns","data-source","expanded-row-keys","loading"])])]),_:1},8,["form-state"])}}});const Le=ae($e,[["__scopeId","data-v-8a66d334"]]);export{Le as default};
