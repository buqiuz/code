import{aj as j,d as K,az as Q,j as T,k as X,o as h,a as m,e as l,b as f,w as y,F as J,A as M,u as i,h as O,f as Y,T as Z,a6 as P,a3 as g,aA as ee,aw as te,C as ne,t as I,aB as oe,aC as ae,a8 as se,a9 as ie,ag as le,aD as re,a1 as ce}from"./index-35141ee5.js";import{E as de}from"./el-link-c0fa233f.js";import{E as ue}from"./el-avatar-948f01f8.js";import"./el-tag-d18553b0.js";import{E as ve,a as fe}from"./el-select-aece7f2f.js";import{E as U}from"./el-scrollbar-d2c305e3.js";import{E as pe}from"./el-card-66c618bc.js";import{E as _e}from"./el-divider-1c12c4b1.js";import{M as he}from"./index-ddedae1d.js";/* empty css                */import{E as me}from"./index-24fa3eb6.js";import"./scroll-fce495f9.js";import"./index-3a866b64.js";import"./castArray-824eebc4.js";import"./index-23ba9dbb.js";import"./vnode-a9496789.js";import"./aria-bc8e8b0f.js";import"./index-53285ed5.js";async function ge(n,t){const o=n.getReader();let e;for(;!(e=await o.read()).done;)t(e.value)}function be(n){let t,o,e,s=!1;return function(d){t===void 0?(t=d,o=0,e=-1):t=we(t,d);const u=t.length;let v=0;for(;o<u;){s&&(t[o]===10&&(v=++o),s=!1);let _=-1;for(;o<u&&_===-1;++o)switch(t[o]){case 58:e===-1&&(e=o-v);break;case 13:s=!0;case 10:_=o;break}if(_===-1)break;n(t.subarray(v,_),e),v=o,e=-1}v===u?t=void 0:v!==0&&(t=t.subarray(v),o-=v)}}function ye(n,t,o){let e=W();const s=new TextDecoder;return function(d,u){if(d.length===0)o==null||o(e),e=W();else if(u>0){const v=s.decode(d.subarray(0,u)),_=u+(d[u+1]===32?2:1),w=s.decode(d.subarray(_));switch(v){case"data":e.data=e.data?e.data+`
`+w:w;break;case"event":e.event=w;break;case"id":n(e.id=w);break;case"retry":const k=parseInt(w,10);isNaN(k)||t(e.retry=k);break}}}}function we(n,t){const o=new Uint8Array(n.length+t.length);return o.set(n),o.set(t,n.length),o}function W(){return{data:"",event:"",id:"",retry:void 0}}var ke=globalThis&&globalThis.__rest||function(n,t){var o={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.indexOf(e)<0&&(o[e]=n[e]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function")for(var s=0,e=Object.getOwnPropertySymbols(n);s<e.length;s++)t.indexOf(e[s])<0&&Object.prototype.propertyIsEnumerable.call(n,e[s])&&(o[e[s]]=n[e[s]]);return o};const A="text/event-stream",Se=1e3,F="last-event-id";function Ee(n,t){var{signal:o,headers:e,onopen:s,onmessage:r,onclose:d,onerror:u,openWhenHidden:v,fetch:_}=t,w=ke(t,["signal","headers","onopen","onmessage","onclose","onerror","openWhenHidden","fetch"]);return new Promise((k,L)=>{const E=Object.assign({},e);E.accept||(E.accept=A);let C;function V(){C.abort(),document.hidden||q()}v||document.addEventListener("visibilitychange",V);let B=Se,a=0;function c(){document.removeEventListener("visibilitychange",V),window.clearTimeout(a),C.abort()}o==null||o.addEventListener("abort",()=>{c(),k()});const x=_??window.fetch,G=s??Ce;async function q(){var N;C=new AbortController;try{const S=await x(n,Object.assign(Object.assign({},w),{headers:E,signal:C.signal}));await G(S),await ge(S.body,be(ye(b=>{b?E[F]=b:delete E[F]},b=>{B=b},r))),d==null||d(),c(),k()}catch(S){if(!C.signal.aborted)try{const b=(N=u==null?void 0:u(S))!==null&&N!==void 0?N:B;window.clearTimeout(a),a=window.setTimeout(q,b)}catch(b){c(),L(b)}}}q()})}function Ce(n){const t=n.headers.get("content-type");if(!(t!=null&&t.startsWith(A)))throw new Error(`Expected content-type to be ${A}, Actual: ${t}`)}function Te(n){return j({url:"/chatGpt/auth/saveConversation",method:"post",data:JSON.stringify(n)})}function Oe(){return j({url:"/chatGpt/auth/conversation/list",method:"get"})}function xe(n){return j({url:"/chatGpt/auth/conversation/detail",method:"get",params:{id:n}})}function qe(n){return j({url:"/chatGpt/auth/conversation/delete",method:"delete",params:{id:n}})}const z=n=>(se("data-v-4e76fb92"),n=n(),ie(),n),Ne={class:"parent_container"},Ie={class:"container"},Ve={class:"left_card"},Be=z(()=>l("div",{class:"left_header"},[l("div",{class:"title"},"历史回话列表"),l("div",{class:"desc"},"你可以快速从云端回复保持的某一时刻会话，云端会话最多保持20条记录")],-1)),Ge={class:"cards"},Pe=["onClick"],je={class:"history_title"},Le={class:"right_card"},Ae={key:0,class:"right_header"},ze=z(()=>l("div",null,"ChatGPT",-1)),De=z(()=>l("span",null,"当前模型为：",-1)),Re={key:1,class:"right_content"},He=le('<div data-v-4e76fb92><div class="header" data-v-4e76fb92> 示例问题 </div><div data-v-4e76fb92> &quot;成都今天的天气怎么样，适合出门运动吗?&quot; </div><div data-v-4e76fb92> &quot;对于我的十岁生日你有什么好点子吗?&quot; </div><div data-v-4e76fb92> &quot;我该如何使用JavaScript来发起一个HTTP请求?&quot; </div></div><div data-v-4e76fb92><div class="header" data-v-4e76fb92> 大致功能 </div><div data-v-4e76fb92> 记录本次对话所有内容，并根据上下文进行回答 </div><div data-v-4e76fb92> 在后续对话中用户可以根据情况提出更正 </div><div data-v-4e76fb92> 对于重要的聊天记录可以保存 </div></div><div data-v-4e76fb92><div class="header" data-v-4e76fb92> 使用限制 </div><div data-v-4e76fb92> 对于某些问题可能会回答出不太正确的结果 </div><div data-v-4e76fb92> GPT4.0使用次数限制 </div><div data-v-4e76fb92> 限制每分钟10次问答 </div></div>',3),Je=[He],Me={class:"questions_container"},Ue={key:0,class:"left_questions"},We={class:"questions_content"},Fe={class:"name"},$e={class:"text"},Ke={key:1,class:"right_questions"},Qe={class:"questions_content"},Xe={class:"name"},Ye={class:"text"},Ze={key:3,class:"conversation"},et={class:"right_tail"},tt={class:"btn"},nt=K({__name:"index",setup(n){const t=Q(),o=T([]);X(()=>{e()});function e(){Oe().then(a=>{console.log(a),a.code===200&&(o.value=a.data)})}const s=T({content:"",model:"gpt-3.5-turbo-0613"}),r=T({content:[],model:s.value.model}),d=T(!1),u=T(!1),v=T(!1),_=new AbortController,w=_.signal,k=T();function L(){Te(r.value).then(a=>{a.code===200&&(g.success(a.data),e()),a.code===500&&g.error(a.data),(a.code===1004||a.code===1002)&&g.warning(a.msg),a.code===1009&&g.warning(a.msg)})}function E(){if(ee({title:"穷!!!",showClose:!1,duration:6e3,message:"该模块未开放，作者没有钱",type:"error"}),s.value.content===""){g.warning("请输入内容");return}d.value=!0,r.value.content.push({type:"question",content:s.value.content}),Ee("http://8.137.91.234:8088/chatGpt/openai/chat",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer "+t.token},openWhenHidden:!0,signal:w,body:JSON.stringify(r.value),onmessage:a=>{const c=JSON.parse(a.data);if(c.code===500){r.value.content[r.value.content.length-1].content+=c.data,r.value.content[r.value.content.length-1].code=500;return}r.value.content[r.value.content.length-1].content+=c},onopen(){return v.value=!0,u.value=!0,r.value.content.push({type:"response",content:""}),Promise.resolve()},onerror(a){v.value=!1,console.log(a)},onclose(){v.value=!1,u.value=!1,k.value.wrapRef.scrollTop=k.value.wrapRef.scrollHeight}}),s.value.content=""}function C(){_.abort(),u.value=!1}function V(a){if(r.value.id===a){g.warning("已在当前会话");return}xe(a).then(c=>{c.code===200?(d.value=!0,r.value=JSON.parse(c.data.conversation),r.value.id=c.data.id,g.success("成功回到会话")):g.error(c.msg)})}function B(a,c){c.stopPropagation(),me.confirm("此操作将永久删除该会话, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{qe(a).then(x=>{x.code===200?(g.success("已删除会话"),e()):g.error(x.msg)})}).catch(()=>{g.info("已取消删除")})}return(a,c)=>{const x=_e,G=te,q=pe,N=re,S=ve,b=fe,D=ue,R=de,$=ne;return h(),m("div",Ne,[l("div",Ie,[l("div",Ve,[Be,f(x),l("div",Ge,[f(i(U),{height:"100%"},{default:y(()=>[(h(!0),m(J,null,M(i(o),p=>(h(),m("div",{key:p.id,style:{margin:"0.4rem"},onClick:H=>V(p.id)},[f(N,null,{default:y(()=>[f(q,{shadow:"hover",class:"history_card"},{default:y(()=>[l("div",je,I(p.conversationTitle),1),l("div",null,[l("div",null,I(p.createTime),1),l("div",null,[f(G,{type:"danger",size:"small",plain:"",onClick:H=>B(p.id,H)},{default:y(()=>[P("删除 ")]),_:2},1032,["onClick"])])])]),_:2},1024)]),_:2},1024)],8,Pe))),128))]),_:1})])]),l("div",Le,[i(d)?O("",!0):(h(),m("div",Ae,[ze,l("div",null,[De,f(b,{modelValue:i(r).model,"onUpdate:modelValue":c[0]||(c[0]=p=>i(r).model=p),placeholder:"gpt-3.5-turbo-1106"},{default:y(()=>[f(S,{label:"gpt-3.5-turbo",value:"gpt-3.5-turbo-0613"}),f(S,{label:"gpt-3.5-turbo-16k",value:"gpt-3.5-turbo-16k-0613"}),f(S,{label:"gpt-4",value:"gpt-4"}),f(S,{label:"gpt-4-0613",value:"gpt-4-0613"})]),_:1},8,["modelValue"])])])),i(d)?O("",!0):(h(),m("div",Re,Je)),f(Z,{name:"el-fade-in-linear"},{default:y(()=>[i(d)?(h(),Y(i(U),{key:0,ref_key:"contentScroll",ref:k},{default:y(()=>[(h(!0),m(J,null,M(i(r).content,p=>(h(),m("div",Me,[p.type==="question"?(h(),m("div",Ue,[f(D,{size:"default",src:i(t).userInfo.avatar},null,8,["src"]),l("div",We,[l("div",Fe,I(i(t).userInfo.nickname),1),l("div",$e,I(p.content),1)])])):O("",!0),p.type==="response"?(h(),m("div",Ke,[f(D,{size:"default",src:"http://8.137.91.234:9000/blog/gpt/chatgpt-de79290a.png"}),l("div",Qe,[l("div",Xe," 人工智能助手 (模型: "+I(i(r).model)+") ",1),l("div",Ye,[f(i(he),{"model-value":p.content},null,8,["model-value"])])])])):O("",!0)]))),256))]),_:1},512)):O("",!0)]),_:1}),!i(u)&&i(d)?(h(),m("div",{key:2,class:"conversation",onClick:L},[f(R,{type:"primary",icon:i(oe)},{default:y(()=>[P("将本次会话保存到云端")]),_:1},8,["icon"])])):O("",!0),i(u)?(h(),m("div",Ze,[f(R,{icon:i(ae),onClick:C},{default:y(()=>[P("停止")]),_:1},8,["icon"])])):O("",!0),l("div",et,[l("div",tt,[f($,{placeholder:"进行提问吧！！",type:"textarea",modelValue:i(s).content,"onUpdate:modelValue":c[1]||(c[1]=p=>i(s).content=p),autosize:{minRows:1,maxRows:4},maxlength:"5000","show-word-limit":"",resize:"none",disabled:i(v)},null,8,["modelValue","disabled"]),f(G,{type:"primary",plain:"",style:{"margin-left":"1rem"},onClick:E,disabled:i(v)},{default:y(()=>[P("发送 ")]),_:1},8,["disabled"])])])])])])}}});const wt=ce(nt,[["__scopeId","data-v-4e76fb92"]]);export{wt as default};
